<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Manual and automated structural variant curation with samplot and samplot-ml | Layer Lab</title>
<meta name="generator" content="Jekyll v3.6.3" />
<meta property="og:title" content="Manual and automated structural variant curation with samplot and samplot-ml" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Structural variant (SV) callers, in order to maximize sensitivity, tend to suffer from high false positive rates. We have shown that it is possible to spot false positive SV calls using Samplot visualizations, but manual curation of large SV callsets can be a long and tedious process. To that end we developed Samplot-ML to discriminate between true and false positive deletion SVs." />
<meta property="og:description" content="Structural variant (SV) callers, in order to maximize sensitivity, tend to suffer from high false positive rates. We have shown that it is possible to spot false positive SV calls using Samplot visualizations, but manual curation of large SV callsets can be a long and tedious process. To that end we developed Samplot-ML to discriminate between true and false positive deletion SVs." />
<link rel="canonical" href="/2021/06/09/SV-curration-with-Samplot.html" />
<meta property="og:url" content="/2021/06/09/SV-curration-with-Samplot.html" />
<meta property="og:site_name" content="Layer Lab" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-09T00:00:00-06:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Manual and automated structural variant curation with samplot and samplot-ml","dateModified":"2021-06-09T00:00:00-06:00","datePublished":"2021-06-09T00:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"/2021/06/09/SV-curration-with-Samplot.html"},"description":"Structural variant (SV) callers, in order to maximize sensitivity, tend to suffer from high false positive rates. We have shown that it is possible to spot false positive SV calls using Samplot visualizations, but manual curation of large SV callsets can be a long and tedious process. To that end we developed Samplot-ML to discriminate between true and false positive deletion SVs.","url":"/2021/06/09/SV-curration-with-Samplot.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Layer Lab" /><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56403324-1', 'auto');
  ga('send', 'pageview');
}
</script>
  
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper">
    
    
    <a class="site-title" rel="author" href="/">Layer Lab</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
            <a class="page-link" href="/join_us/">Join Us</a>
            
          
            
            
            <a class="page-link" href="/people/">People</a>
            
          
            
            
            <a class="page-link" href="/Publications/">Publications</a>
            
          
            
            
            <a class="page-link" href="/software/">Software</a>
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Manual and automated structural variant curation with samplot and samplot-ml</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-06-09T00:00:00-06:00" itemprop="datePublished">Jun 9, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Structural variant (SV) callers, in order to maximize sensitivity, tend to
suffer from high false positive rates.  We have shown that it is possible to
spot false positive SV calls using Samplot visualizations, but manual curation
of large SV callsets can be a long and tedious process.  To that end we
developed Samplot-ML to discriminate between true and false positive deletion
SVs.</p>

<p>For the better part of the past decade, convolutional neural networks (CNNs)
have been used in image recognition tasks across a wide range of domains.
Since Samplot was demonstrated to be an effective visualization tool for
curating SV callsets, it made sense to try to train a CNN to be able to do it
for us.</p>

<p>The workflow for Samplot-ML is simple: given a whole-genome sequenced sample
(BAM or CRAM) as well as a set of putative deletions (VCF), Samplot-ML
re-genotypes each putative deletion using the Samplot-generated image. The
result is a call set where most false positives are flagged.  For
installation/usage instructions see our github <a href="https://github.com/mchowdh200/samplot-ml">github repo</a></p>

<h2 id="example-usage">Example Usage:</h2>

<p>To demonstrate how to use Samplot-ML, let’s work through a simple example that
takes us from calling SV’s to executing the Samplot-ML snakefile using some
data from the 1000 genomes project (1kg).</p>

<h3 id="calling-svs-with-smoove">Calling SVs with <a href="https://github.com/brentp/smoove">smoove</a></h3>

<ol>
  <li>Download a CRAM file from 1kg’s ftp
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget ftp://ftp.sra.ebi.ac.uk/vol1/run/ERR324/ERR3242876/HG03687.final.cram
$ wget ftp://ftp.sra.ebi.ac.uk/vol1/run/ERR324/ERR3242876/HG03687.final.cram.crai
</code></pre></div>    </div>
  </li>
  <li>Get the reference genome
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget ftp://ftp.1000genomes.ebi.ac.uk/vol1/ftp/technical/reference/GRCh38_reference_genome/GRCh38_full_analysis_set_plus_decoy_hla.fa
$ wget ftp://ftp.1000genomes.ebi.ac.uk/vol1/ftp/technical/reference/GRCh38_reference_genome/GRCh38_full_analysis_set_plus_decoy_hla.fa.fai
</code></pre></div>    </div>
  </li>
  <li>Get a set of exclude regions in bed format for use during SV calling
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget https://raw.githubusercontent.com/hall-lab/speedseq/master/annotations/exclude.cnvnator_100bp.GRCh38.20170403.bed
</code></pre></div>    </div>
  </li>
  <li>Install smoove with conda
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ conda create -c bioconda -n smoove smoove
</code></pre></div>    </div>
  </li>
  <li>Call SVs
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ conda activate smoove
$ smoove call -x \
 --name HG03687 \
 --exclude $exclude_bed \
 --fasta $reference \
 --genotype \
 --outdir $outdir
 $cram
</code></pre></div>    </div>
  </li>
</ol>

<p>The resulting vcf will be <code class="highlighter-rouge">$outdir/HG003687-smoove.genotyped.vcf.gz</code>.</p>

<ol>
  <li>
    <p>Clone the Samplot-ML git repo</p>
  </li>
  <li>
    <p>Next, let’s edit the config file located at <code class="highlighter-rouge">samplot-ml/workflows/samplot-ml-predict.yaml</code></p>
  </li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>samples:
	HG03687: "/path/to/cram" # or you can use "s3://bucket/bam_or_cram" if you've got alignments in an s3 bucket.
fasta:
	data_source: "local" # either local or s3
	file: "/path/to/reference" # or "s3://bucket/reference_file"
fai:
	data_source: "local"
	file: "/path/to/reference_index"
vcf:
	data_source: "local"
	file: "/path/to/vcf"

# generated images will have filename: ${contig}-${start}-${end}-DEL.png
# we give the choice of delimiter since contigs can sometimes contain
# character like hypens, underscores, etc.
image_filename_delimiter: "-"
outdir: "/path/to/output_directory"
</code></pre></div></div>

<ol>
  <li>Run the prediction snakefile located at samplot-ml/workflows/samplot-ml-predict.smk
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda activate snakemake
snakemake -s samplot-ml-predict.smk \
       -j $num_threads \ # number of parallel threads to use to execute jobs
       --use-conda --conda-fronend mamba # this allows snakemake to handle dependencies
</code></pre></div>    </div>
  </li>
</ol>

<p>Generated images of DEL regions from the input VCF will be located at
<code class="highlighter-rouge">$outdir/img/</code> each image will be named <code class="highlighter-rouge">${contig}-${start}-${end}-DEL.png</code>. An
annotated vcf containing the Samplot-ML predictions will be located at
<code class="highlighter-rouge">$outdir/samplot-ml-results/HG03687-samplot-ml.vcf.gz</code></p>

<h3 id="vcf-annotations">VCF annotations</h3>

<p>The resulting prediction vcf will contain the following format fields:</p>

<ul>
  <li>PREF, PHET, and PALT: the prediction score assigned by the model which
corresponds to a prediction of a 0/0, 0/1, or 1/1 genotype, respectively. If
the region in the input vcf was originally a 0/0, then these fields will
contain ‘nan’ values</li>
  <li>OLDGT: The original genotype of the region from the input
SV callset.</li>
  <li>If the predicted genotype differed from the input genotype, then the model
 will replace the GT field with the predicted genotype.</li>
</ul>

<h3 id="back-to-our-example">Back to our example</h3>

<p>Now that we’ve got our annotated VCF, let’s inspect one of the predictions and
compare it with the samplot image.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># get the first DEL region from the vcf.  Print out the filename of the
# samplot image, the original genotype and the samplot-ml predicted genotype.
$ bcftools query -i 'SVTYPE="DEL"' -f '%CHROM-%POS-%INFO/END-[%SAMPLE].png\t[%OLDGT\t%GT]\n' HG03687-samplot-ml.vcf.gz | head -1
</code></pre></div></div>
<p>output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chr1-934098-934868-HG03687.png	0/1	1/1
</code></pre></div></div>

<p>It seems that in the very first deletion we came across, there was a difference between SVTyper’s prediction and Samplot-ML’s prediction. We went from a heterozygous deletion (0/1) to a homozygous alternate deletion (1/1). Let’s take a look at the image in question.</p>

<center><img src="https://raw.githubusercontent.com/mchowdh200/samplot-ml/master/figures/chr1-934098-934868-HG03687-DEL.png" /></center>

  </div>

  <a class="u-url" href="/2021/06/09/SV-curration-with-Samplot.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Layer Lab</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Layer Lab</li><li><a class="u-email" href="mailto:web@layerlab.org">web@layerlab.org</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ryanlayer"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ryanlayer</span></a></li><li><a href="https://www.twitter.com/ryanlayer"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">ryanlayer</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Developing algorithms for large-scale genomics at CU Boulder Computer Science and Biofrontiers Institute. Make science faster.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
